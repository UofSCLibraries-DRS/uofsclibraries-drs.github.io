
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tidy Text Case Studies &#8212; USC Libraries - DRS Resources for Data Literacy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'src/RForTextAnalysis/GettingStarted/Tidy_Text_Case_Studies';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/USC_Libraries_logo_horizontal_RGB_2C.png" class="logo__image only-light" alt="USC Libraries - DRS Resources for Data Literacy - Home"/>
    <script>document.write(`<img src="../../../_static/USC_Libraries_logo_horizontal_RGB_2C.png" class="logo__image only-dark" alt="USC Libraries - DRS Resources for Data Literacy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python for Data Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PythonForDataAnalysis/GettingStarted/GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForDataAnalysis/GettingData/GettingData.html">Getting Data (APIs, Web Scraping)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PythonForDataAnalysis/DataCleaningBasics/DataCleaning_Basics.html">Data Cleaning Basics</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../PythonForDataAnalysis/DataVisualization/DataVisualization.html">Data Visualization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Python for Text Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../TextMining/IntroductionTextAnalysis.html">Introduction to Text Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TextMining/AdvancedTextAnalysis.html">Advanced Text Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TextMining/MultiLingualNer.html">Named Entity Recognition (NER)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TextMining/TextPreprocessing/TextPreprocessingMethods.html">Example</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">R for Data Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../RForDataAnalysis/Data_Wrangling.html">Getting Started</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">R for Text Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MachineLearning/PythonCode/Python.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MachineLearning/RCode/R.html">R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">App Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../AppDevelopment/AppDevelopment.html">Getting Started</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/UofSCLibraries-DRS/uofsclibraries-drs.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/UofSCLibraries-DRS/uofsclibraries-drs.github.io/issues/new?title=Issue%20on%20page%20%2Fsrc/RForTextAnalysis/GettingStarted/Tidy_Text_Case_Studies.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/src/RForTextAnalysis/GettingStarted/Tidy_Text_Case_Studies.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tidy Text Case Studies</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-packages">Install Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-comparing-twitter-archives">Case study: Comparing Twitter Archives</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-data-and-distribution">Getting the Data and Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#word-frequencies">Word Frequencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-word-usage">Comparing Word Usage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changes-in-word-use">Changes in Word Use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#favorites-and-retweets">Favorites and Retweets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-analyzing-usenet-text">Case Study: Analyzing Usenet Text</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing">Pre-processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing-text">Pre-processing Text</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#words-in-newsgroups">Words in Newsgroups</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-tf-idf-within-newsgroups">Finding tf-idf Within Newsgroups</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#topic-modeling">Topic Modeling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis">Sentiment Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis-by-word">Sentiment Analysis by Word</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis-by-message">Sentiment Analysis by Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#n-gram-analysis">N-gram Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tidy-text-case-studies">
<h1>Tidy Text Case Studies<a class="headerlink" href="#tidy-text-case-studies" title="Link to this heading">#</a></h1>
<section id="install-packages">
<h2>Install Packages<a class="headerlink" href="#install-packages" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;lubridate&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ggplot2&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;readr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="case-study-comparing-twitter-archives">
<h2>Case study: Comparing Twitter Archives<a class="headerlink" href="#case-study-comparing-twitter-archives" title="Link to this heading">#</a></h2>
<p>Online text, especially from platforms like Twitter, receives a lot of attention in text analysis. Many sentiment lexicons used in this book were specifically designed for or validated on tweets, reflecting the unique language and style found there. Both authors of this book are active Twitter users, so this case study explores a comparison between the entire Twitter archives of <a class="reference external" href="https://x.com/juliasilge">Julia</a> and <a class="reference external" href="https://x.com/drob">David</a>.</p>
<section id="getting-the-data-and-distribution">
<h3>Getting the Data and Distribution<a class="headerlink" href="#getting-the-data-and-distribution" title="Link to this heading">#</a></h3>
<p>Individuals can download their own Twitter archives by following <a class="reference external" href="https://help.x.com/en/managing-your-account/how-to-download-your-x-archive">instructions provided on Twitter’s website</a>. After downloading their archives, the next step is to load the data and use the <strong>lubridate</strong> package to convert the string-formatted timestamps into proper date-time objects. This conversion enables easier analysis of tweeting patterns over time. Initially, we can explore overall tweeting behavior by summarizing or visualizing the frequency and timing of tweets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>

<span class="n">tweets_julia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;data/tweets_julia.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">show_col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">tweets_dave</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;data/tweets_dave.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">show_col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tweets_julia</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                      </span><span class="nf">mutate</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Julia&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">tweets_dave</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                      </span><span class="nf">mutate</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;David&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ymd_hms</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">tweets</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;identity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/f240d261acaca000d65c28fc61f2747e0e7519558be70849397a0e2f01affc3b.png"><img alt="../../../_images/f240d261acaca000d65c28fc61f2747e0e7519558be70849397a0e2f01affc3b.png" src="../../../_images/f240d261acaca000d65c28fc61f2747e0e7519558be70849397a0e2f01affc3b.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>David and Julia currently tweet at roughly the same rate and joined Twitter about a year apart, but there was a period of about five years when David was inactive on the platform while Julia remained active. As a result, Julia has accumulated approximately four times as many tweets as David overall.</p>
</section>
<section id="word-frequencies">
<h3>Word Frequencies<a class="headerlink" href="#word-frequencies" title="Link to this heading">#</a></h3>
<p>We’ll use <a class="reference external" href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html"><code class="docutils literal notranslate"><span class="pre">unnest_tokens()</span></code></a> to create a tidy data frame containing all the words from our tweets and remove common English stop words. Since people use text on Twitter differently than in traditional narratives, we’ll use a specialized tokenizer and apply some additional text cleaning compared to what we did with Project Gutenberg text.</p>
<p>First, we’ll filter out retweets from the dataset to focus only on tweets we wrote ourselves. Then, the <a class="reference external" href="https://dplyr.tidyverse.org/reference/mutate.html"><code class="docutils literal notranslate"><span class="pre">mutate()</span></code></a> step removes links and unwanted characters like ampersands and other symbols.</p>
<p>In the <a class="reference external" href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html"><code class="docutils literal notranslate"><span class="pre">unnest_tokens()</span></code></a> call, we use a regular expression pattern instead of extracting simple unigrams. This regex is particularly helpful for handling Twitter text or content from online platforms—it keeps hashtags and &#64; mentions intact.</p>
<p>Because hashtags and usernames remain in the dataset, using a basic <a class="reference external" href="https://dplyr.tidyverse.org/reference/filter-joins.html"><code class="docutils literal notranslate"><span class="pre">anti_join()</span></code></a> to remove stop words isn’t sufficient. Instead, the <a class="reference external" href="https://dplyr.tidyverse.org/reference/filter.html"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a> line demonstrates how to use <a class="reference external" href="https://stringr.tidyverse.org/reference/str_detect.html"><code class="docutils literal notranslate"><span class="pre">str_detect()</span></code></a> from the <strong>stringr</strong> package to exclude stop words more effectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>

<span class="n">replace_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;https://t.co/[A-Za-z\\d]+|http://[A-Za-z\\d]+|&amp;amp;|&amp;lt;|&amp;gt;|RT|https&quot;</span>
<span class="n">unnest_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;([^A-Za-z_\\d#@&#39;]|&#39;(?![A-Za-z_\\d#@]))&quot;</span>

<span class="n">tidy_tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^RT&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">replace_reg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest_tokens</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;regex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unnest_reg</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">word</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">,</span>
<span class="w">         </span><span class="o">!</span><span class="n">word</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">str_remove_all</span><span class="p">(</span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">),</span>
<span class="w">         </span><span class="nf">str_detect</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[a-z]&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can now compute word frequencies for each individual. To do this, we first group the data by person and word, counting the number of times each word appears per person. Next, we perform a <a class="reference external" href="https://dplyr.tidyverse.org/reference/mutate-joins.html"><code class="docutils literal notranslate"><span class="pre">left\_join()</span></code></a> to bring in the total word counts for each person — Julia’s total is larger since she has more tweets overall. Finally, we calculate the frequency of each word for each person by dividing the word count by the total words they used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">frequency</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">left_join</span><span class="p">(</span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">              </span><span class="nf">count</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;total&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="n">total</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Joining with `by = join_by(person)`
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 20,722 x 5
   person word               n total    freq
   &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
 1 Julia  time             584 74541 0.00783
 2 Julia  @selkie1970      570 74541 0.00765
 3 Julia  @skedman         531 74541 0.00712
 4 Julia  day              467 74541 0.00627
 5 Julia  baby             408 74541 0.00547
 6 David  @hadleywickham   315 20150 0.0156 
 7 Julia  love             304 74541 0.00408
 8 Julia  @haleynburke     299 74541 0.00401
 9 Julia  house            289 74541 0.00388
10 Julia  morning          278 74541 0.00373
# i 20,712 more rows
</pre></div>
</div>
</div>
</div>
<p>This gives us a clean and tidy data frame, but to visualize those frequencies with one person’s frequency on the x-axis and the other’s on the y-axis, we need to reshape the data. We can use tidyr’s <a class="reference external" href="https://tidyr.tidyverse.org/reference/pivot_wider.html"><code class="docutils literal notranslate"><span class="pre">pivot\_wider()</span></code></a> function to transform the data frame so that each person’s word frequencies become separate columns, ready for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>

<span class="n">frequency</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">frequency</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">freq</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="n">Julia</span><span class="p">,</span><span class="w"> </span><span class="n">David</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 17,629 x 3
   word                 Julia     David
   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;
 1 &#39;s               0.0000134 0.0000496
 2 1x               0.0000134 0.0000496
 3 5k               0.0000134 0.0000496
 4 @accidental__art 0.0000134 0.0000496
 5 @alice_data      0.0000134 0.0000496
 6 @alistaire       0.0000134 0.0000496
 7 @corynissen      0.0000134 0.0000496
 8 @jennybryan&#39;s    0.0000134 0.0000496
 9 @jsvine          0.0000134 0.0000496
10 @lizasperling    0.0000134 0.0000496
# i 17,619 more rows
</pre></div>
</div>
</div>
</div>
<p>This reshaped data is now ready for visualization. We can use <a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_jitter.html"><code class="docutils literal notranslate"><span class="pre">geom_jitter()</span></code></a> to help spread out the points, reducing the visual clumping that happens with low-frequency words. Additionally, setting <code class="docutils literal notranslate"><span class="pre">check_overlap</span> <span class="pre">=</span> <span class="pre">TRUE</span></code> on the text labels will prevent them from overlapping excessively, so only a subset of labels will appear clearly on the plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">))</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">Julia</span><span class="p">,</span><span class="w"> </span><span class="n">David</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">),</span><span class="w"> </span><span class="n">check_overlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_log10</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">percent_format</span><span class="p">())</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_log10</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">percent_format</span><span class="p">())</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_abline</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
&quot;Removed 14536 rows containing missing values or values outside the scale range
(`geom_point()`).&quot;
Warning message:
&quot;Removed 14536 rows containing missing values or values outside the scale range
(`geom_text()`).&quot;
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/7865d750d296fd59ed4ddd2b7a416548763c0f652d6dbf4a3059392cb44a9756.png"><img alt="../../../_images/7865d750d296fd59ed4ddd2b7a416548763c0f652d6dbf4a3059392cb44a9756.png" src="../../../_images/7865d750d296fd59ed4ddd2b7a416548763c0f652d6dbf4a3059392cb44a9756.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>Words that fall close to the diagonal line on the plot are used at roughly equal rates by both David and Julia. In contrast, words that sit farther from the line are more heavily favored by one person over the other. The plot only shows words, hashtags, and usernames that both individuals have used at least once in their tweets.</p>
<p>It’s clear from this visualization—and will continue to be throughout the chapter—that David and Julia have approached Twitter in very different ways over the years. David’s tweets have been almost entirely professional since he became active, whereas Julia’s early Twitter use was personal, and even now, her account retains more personal content than David’s. This difference in usage patterns is reflected immediately in how they use language on the platform.</p>
</section>
<section id="comparing-word-usage">
<h3>Comparing Word Usage<a class="headerlink" href="#comparing-word-usage" title="Link to this heading">#</a></h3>
<p>We’ve already visualized a comparison of raw word frequencies across the entire Twitter histories of David and Julia. Now, let’s dig deeper by identifying which words are more or less likely to originate from each person’s account using the log odds ratio. To keep the comparison meaningful, we’ll limit the analysis to tweets from 2016—a year when David was consistently active on Twitter and Julia was transitioning into her data science career.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">&quot;2016-01-01&quot;</span><span class="p">),</span>
<span class="w">         </span><span class="n">timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">&quot;2017-01-01&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll use <a class="reference external" href="https://stringr.tidyverse.org/reference/str_detect.html"><code class="docutils literal notranslate"><span class="pre">str_detect()</span></code></a> to filter out Twitter usernames from our word column. Otherwise, the analysis would be dominated by names of people David or Julia know, which doesn’t tell us much about broader word usage differences.</p>
<p>Once usernames are removed, we count how many times each person uses each word and keep only words that appear more than 10 times to avoid results driven by very rare terms. After reshaping the data with <a class="reference external" href="https://tidyr.tidyverse.org/reference/pivot_wider.html"><code class="docutils literal notranslate"><span class="pre">pivot_wider()</span></code></a>, we calculate the <strong>log odds ratio</strong> for each word as:</p>
<div class="math notranslate nohighlight">
\[
\text{log odds ratio} = \ln \left( \frac{(n + 1) / (total + 1) \text{ for David}}{(n + 1) / (total + 1) \text{ for Julia}} \right)
\]</div>
<p>Here:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the count of the word for each person,</p></li>
<li><p><span class="math notranslate nohighlight">\(total\)</span> is the total word count for each person,</p></li>
<li><p>Adding 1 to both numerator and denominator prevents division by zero for rare words.</p></li>
</ul>
<p>This gives a clearer picture of which words are disproportionately associated with one person versus the other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_ratios</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^@&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">pivot_wider</span><span class="p">(</span><span class="n">names_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">values_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">values_fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">logratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">David</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Julia</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">logratio</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Here are some words that have been about equally likely to come from David or Julia’s account during 2016.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_ratios</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">logratio</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 377 x 4
   word         David   Julia logratio
   &lt;chr&gt;        &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 email      0.00229 0.00228  0.00463
 2 file       0.00229 0.00228  0.00463
 3 map        0.00252 0.00254 -<span class=" -Color -Color-Red">0.00543</span>
 4 names      0.00413 0.00406  0.0170 
 5 account    0.00183 0.00177  0.0328 
 6 api        0.00183 0.00177  0.0328 
 7 function   0.00367 0.00355  0.0328 
 8 population 0.00183 0.00177  0.0328 
 9 sad        0.00183 0.00177  0.0328 
10 words      0.00367 0.00355  0.0328 
# i 367 more rows
</pre></div>
</div>
</div>
</div>
<p>We are about equally likely to tweet about maps, email, files, and APIs.</p>
<p>To find the words most strongly associated with each account, we select the top 15 words with the highest positive log odds ratio (most likely from David’s account) and the top 15 words with the lowest (most negative) log odds ratio (most likely from Julia’s account).</p>
<p>Plotting these words will clearly show which terms are most distinctive for each person’s tweets, highlighting the differences in their language use during 2016.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_ratios</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">logratio</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">logratio</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">logratio</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">logratio</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">logratio</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylab</span><span class="p">(</span><span class="s">&quot;log odds ratio (David/Julia)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_fill_discrete</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;David&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Julia&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/bc5a0db1abd8d44c118600755c1c659146f49e3dd36e9f2be52b39907ff70bfa.png"><img alt="../../../_images/bc5a0db1abd8d44c118600755c1c659146f49e3dd36e9f2be52b39907ff70bfa.png" src="../../../_images/bc5a0db1abd8d44c118600755c1c659146f49e3dd36e9f2be52b39907ff70bfa.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>David’s tweets tend to focus on professional topics like conferences and programming, reflecting his career interests, while Julia’s tweets highlight personal themes like family and regional topics such as Utah and Census data.</p>
</section>
<section id="changes-in-word-use">
<h3>Changes in Word Use<a class="headerlink" href="#changes-in-word-use" title="Link to this heading">#</a></h3>
<p>The previous section focused on overall word usage, but now we want to explore a different question: which words have changed in frequency the most over time in the Twitter feeds? In other words, which words have they tweeted about more or less as time has gone on?</p>
<p>To analyze this, we first create a new time variable in the data frame that groups each tweet into a specific time unit. Using lubridate’s <a class="reference external" href="https://lubridate.tidyverse.org/reference/round_date.html"><code class="docutils literal notranslate"><span class="pre">floor_date()</span></code></a> function, we round timestamps down to the start of each month, which works well for this year of tweets.</p>
<p>Once these time bins are set, we count how often each person used each word within each month. Then, we add columns showing the total words tweeted by each person per month and the total uses of each word by each person overall. Finally, we can <a class="reference external" href="https://dplyr.tidyverse.org/reference/filter.html"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a> the data to keep only words that appear at least 30 times, ensuring we focus on words with sufficient usage for meaningful analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">words_by_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^@&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">time_floor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">floor_date</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1 month&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">time_floor</span><span class="p">,</span><span class="w"> </span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">time_floor</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">time_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">rename</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">word_total</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">30</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">words_by_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 327 x 6
   time_floor          person word    count time_total word_total
   &lt;dttm&gt;              &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
 1 2016-01-01 00:00:00 David  #rstats     2        306        208
 2 2016-01-01 00:00:00 David  broom       2        306         39
 3 2016-01-01 00:00:00 David  data        2        306        165
 4 2016-01-01 00:00:00 David  ggplot2     1        306         39
 5 2016-01-01 00:00:00 David  tidy        1        306         46
 6 2016-01-01 00:00:00 David  time        2        306         58
 7 2016-01-01 00:00:00 David  tweets      1        306         46
 8 2016-01-01 00:00:00 Julia  #rstats    10        401        116
 9 2016-01-01 00:00:00 Julia  blog        2        401         33
10 2016-01-01 00:00:00 Julia  data        5        401        111
# i 317 more rows
</pre></div>
</div>
</div>
</div>
<p>Each row in this data frame represents a single person’s use of a specific word within a particular time bin. The <code class="docutils literal notranslate"><span class="pre">count</span></code> column shows how many times that person used the word in that time period, <code class="docutils literal notranslate"><span class="pre">time_total</span></code> gives the total number of words the person tweeted during that time bin, and <code class="docutils literal notranslate"><span class="pre">word_total</span></code> indicates the total number of times that person used that word throughout the entire year. This dataset is ready to be used for modeling purposes.</p>
<p>Next, we can apply <a class="reference external" href="https://tidyr.tidyverse.org/reference/nest.html"><code class="docutils literal notranslate"><span class="pre">nest()</span></code></a> from tidyr to create a data frame where each word corresponds to a list-column containing smaller data frames—essentially mini datasets—for each word. Let’s go ahead and do that, then examine the structure of the resulting nested data frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nested_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">words_by_time</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">nest</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="o">-</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">person</span><span class="p">))</span><span class="w"> </span>

<span class="nf">print</span><span class="p">(</span><span class="n">nested_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 32 x 3
   person word    data             
   &lt;chr&gt;  &lt;chr&gt;   &lt;list&gt;           
 1 David  #rstats &lt;tibble [12 x 4]&gt;
 2 David  broom   &lt;tibble [10 x 4]&gt;
 3 David  data    &lt;tibble [12 x 4]&gt;
 4 David  ggplot2 &lt;tibble [10 x 4]&gt;
 5 David  tidy    &lt;tibble [11 x 4]&gt;
 6 David  time    &lt;tibble [12 x 4]&gt;
 7 David  tweets  &lt;tibble [8 x 4]&gt; 
 8 Julia  #rstats &lt;tibble [12 x 4]&gt;
 9 Julia  blog    &lt;tibble [10 x 4]&gt;
10 Julia  data    &lt;tibble [12 x 4]&gt;
# i 22 more rows
</pre></div>
</div>
</div>
</div>
<p>This data frame contains one row for each unique person-word pair, and the <code class="docutils literal notranslate"><span class="pre">data</span></code> column is a list-column holding smaller data frames for each of those pairs. We’ll use <a class="reference external" href="https://purrr.tidyverse.org/reference/map.html"><code class="docutils literal notranslate"><span class="pre">map()</span></code></a> from the purrr package <a class="reference external" href="https://www.tidytextmining.com/references#ref-R-purrr">(Henry and Wickham 2018)</a> to run our modeling function on each of these nested data frames.</p>
<p>Since the data involves counts, we’ll fit a generalized linear model using <a class="reference external" href="https://rdrr.io/r/stats/glm.html"><code class="docutils literal notranslate"><span class="pre">glm()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">family</span> <span class="pre">=</span> <span class="pre">&quot;binomial&quot;</span></code>. Essentially, this model answers a question like: “Was this particular word mentioned during this time bin (yes or no)? How does the likelihood of mentioning this word change over time?”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">))</span>

<span class="n">nested_models</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nested_data</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">time_total</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time_floor</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                  </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binomial&quot;</span><span class="p">)))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">nested_models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 32 x 4
   person word    data              models
   &lt;chr&gt;  &lt;chr&gt;   &lt;list&gt;            &lt;list&gt;
 1 David  #rstats &lt;tibble [12 x 4]&gt; &lt;glm&gt; 
 2 David  broom   &lt;tibble [10 x 4]&gt; &lt;glm&gt; 
 3 David  data    &lt;tibble [12 x 4]&gt; &lt;glm&gt; 
 4 David  ggplot2 &lt;tibble [10 x 4]&gt; &lt;glm&gt; 
 5 David  tidy    &lt;tibble [11 x 4]&gt; &lt;glm&gt; 
 6 David  time    &lt;tibble [12 x 4]&gt; &lt;glm&gt; 
 7 David  tweets  &lt;tibble [8 x 4]&gt;  &lt;glm&gt; 
 8 Julia  #rstats &lt;tibble [12 x 4]&gt; &lt;glm&gt; 
 9 Julia  blog    &lt;tibble [10 x 4]&gt; &lt;glm&gt; 
10 Julia  data    &lt;tibble [12 x 4]&gt; &lt;glm&gt; 
# i 22 more rows
</pre></div>
</div>
</div>
</div>
<p>Now we see a new column holding the modeling results—this is another list-column, each entry containing a <code class="docutils literal notranslate"><span class="pre">glm</span></code> model object. The next step is to use <a class="reference external" href="https://purrr.tidyverse.org/reference/map.html"><code class="docutils literal notranslate"><span class="pre">map()</span></code></a> together with <a class="reference external" href="https://generics.r-lib.org/reference/tidy.html"><code class="docutils literal notranslate"><span class="pre">tidy()</span></code></a> from the broom package to extract the slope coefficients from each model.</p>
<p>Since we’re testing many slopes simultaneously and some won’t be statistically significant, we’ll adjust the p-values to account for multiple comparisons, helping to control for false positives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>

<span class="n">slopes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nested_models</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">models</span><span class="p">,</span><span class="w"> </span><span class="n">tidy</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">models</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">term</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;time_floor&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">adjusted.p.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">p.adjust</span><span class="p">(</span><span class="n">p.value</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll identify the most notable slopes—that is, the words whose usage frequencies have changed over time with moderate statistical significance in our tweets. By filtering the results for adjusted p-values below a chosen threshold (e.g., 0.05), we can pinpoint these words and understand which topics or terms have become more or less common during the period analyzed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">top_slopes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">slopes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">adjusted.p.value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0.05</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">top_slopes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 6 x 9
  person word      data              term   estimate std.error statistic p.value
  &lt;chr&gt;  &lt;chr&gt;     &lt;list&gt;            &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 David  ggplot2   &lt;tibble [10 x 4]&gt; time_~ -<span class=" -Color -Color-Red">8.27</span>e<span class=" -Color -Color-Red">-8</span>   1.97e<span class=" -Color -Color-Red">-8</span>     -<span class=" -Color -Color-Red">4.20</span> 2.69e<span class=" -Color -Color-Red">-5</span>
2 Julia  #rstats   &lt;tibble [12 x 4]&gt; time_~ -<span class=" -Color -Color-Red">4.49</span>e<span class=" -Color -Color-Red">-8</span>   1.12e<span class=" -Color -Color-Red">-8</span>     -<span class=" -Color -Color-Red">4.01</span> 5.97e<span class=" -Color -Color-Red">-5</span>
3 Julia  post      &lt;tibble [12 x 4]&gt; time_~ -<span class=" -Color -Color-Red">4.82</span>e<span class=" -Color -Color-Red">-8</span>   1.45e<span class=" -Color -Color-Red">-8</span>     -<span class=" -Color -Color-Red">3.31</span> 9.27e<span class=" -Color -Color-Red">-4</span>
4 David  overflow  &lt;tibble [10 x 4]&gt; time_~  7.25e<span class=" -Color -Color-Red">-8</span>   2.23e<span class=" -Color -Color-Red">-8</span>      3.25 1.17e<span class=" -Color -Color-Red">-3</span>
5 David  stack     &lt;tibble [10 x 4]&gt; time_~  8.04e<span class=" -Color -Color-Red">-8</span>   2.19e<span class=" -Color -Color-Red">-8</span>      3.67 2.47e<span class=" -Color -Color-Red">-4</span>
6 David  #user2016 &lt;tibble [3 x 4]&gt;  time_~ -<span class=" -Color -Color-Red">8.18</span>e<span class=" -Color -Color-Red">-7</span>   1.55e<span class=" -Color -Color-Red">-7</span>     -<span class=" -Color -Color-Red">5.27</span> 1.34e<span class=" -Color -Color-Red">-7</span>
# i 1 more variable: adjusted.p.value &lt;dbl&gt;
</pre></div>
</div>
</div>
</div>
<p>To visualize these findings, we can create plots showing how the usage of these words has changed over the course of the year for both David and Julia. This will help illustrate trends in word frequency over time, highlighting the differences and similarities in their tweeting patterns throughout the year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">words_by_time</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="n">top_slopes</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;word&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;person&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;David&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">time_floor</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">/</span><span class="n">time_total</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Word frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/15c9de2fb8ca480782319a1bcd40d6a1d369bf034f13d1eb3cc9bae0cd7e6388.png"><img alt="../../../_images/15c9de2fb8ca480782319a1bcd40d6a1d369bf034f13d1eb3cc9bae0cd7e6388.png" src="../../../_images/15c9de2fb8ca480782319a1bcd40d6a1d369bf034f13d1eb3cc9bae0cd7e6388.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>This shows that David tweeted extensively about the UseR conference during the event, but his mentions dropped off quickly afterward. Additionally, his tweets about Stack Overflow increased toward the end of the year, while references to ggplot2 declined over time.</p>
<p>Now let’s plot words that have changed frequency in Julia’s tweets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">words_by_time</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="n">top_slopes</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;word&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;person&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Julia&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">time_floor</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="o">/</span><span class="n">time_total</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Word frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/b33e821fae5629c6f59aab52534c6173bbd672ab79ac8a7be03d5258b3b28bee.png"><img alt="../../../_images/b33e821fae5629c6f59aab52534c6173bbd672ab79ac8a7be03d5258b3b28bee.png" src="../../../_images/b33e821fae5629c6f59aab52534c6173bbd672ab79ac8a7be03d5258b3b28bee.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>All of Julia’s significant slopes are negative, indicating she hasn’t increased her use of any particular words over the year. Instead, she’s used a wider variety of words, with the ones shown in this plot appearing more frequently earlier in the year. For example, words related to sharing new blog posts—like the hashtag #rstats and the word “post”—have decreased in usage over time.</p>
</section>
<section id="favorites-and-retweets">
<h3>Favorites and Retweets<a class="headerlink" href="#favorites-and-retweets" title="Link to this heading">#</a></h3>
<p>Another key aspect of tweets is how often they get favorited or retweeted. To analyze which words are associated with higher engagement on Julia’s and David’s tweets, they created a separate dataset that includes favorites and retweets information. Since Twitter archives don’t include this data, they collected roughly 3,200 tweets for each of them directly from the Twitter API, covering about the last 18 months of activity—a period during which both of them increased their tweeting frequency and follower counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tweets_julia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;data/juliasilge_tweets.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">show_col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">tweets_dave</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;data/drob_tweets.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">show_col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tweets_julia</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                      </span><span class="nf">mutate</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Julia&quot;</span><span class="p">),</span>
<span class="w">                    </span><span class="n">tweets_dave</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">                      </span><span class="nf">mutate</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;David&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ymd_hms</span><span class="p">(</span><span class="n">created_at</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have this smaller, more recent dataset, we’ll again use <a class="reference external" href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html"><code class="docutils literal notranslate"><span class="pre">unnest_tokens()</span></code></a> to convert the tweets into a tidy format. We’ll filter out all retweets and replies to focus solely on the original tweets posted directly by David and Julia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^(RT|@)&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str_replace_all</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">replace_reg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest_tokens</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;regex&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unnest_reg</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">word</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">,</span>
<span class="w">         </span><span class="o">!</span><span class="n">word</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">str_remove_all</span><span class="p">(</span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">tidy_tweets</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 11,074 x 7
        id created_at          source            retweets favorites person word 
     &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;
 1 8.04e17 2016-12-01 16:44:03 Twitter Web Clie~        0         0 Julia  score
 2 8.04e17 2016-12-01 16:44:03 Twitter Web Clie~        0         0 Julia  50   
 3 8.04e17 2016-12-01 16:42:03 Twitter Web Clie~        0         9 Julia  snow~
 4 8.04e17 2016-12-01 16:42:03 Twitter Web Clie~        0         9 Julia  drin~
 5 8.04e17 2016-12-01 16:42:03 Twitter Web Clie~        0         9 Julia  tea  
 6 8.04e17 2016-12-01 16:42:03 Twitter Web Clie~        0         9 Julia  #rst~
 7 8.04e17 2016-12-01 02:56:10 Twitter Web Clie~        0        11 Julia  julie
 8 8.04e17 2016-12-01 02:56:10 Twitter Web Clie~        0        11 Julia  help~
 9 8.04e17 2016-12-01 02:56:10 Twitter Web Clie~        0        11 Julia  pyth~
10 8.04e17 2016-12-01 02:56:10 Twitter Web Clie~        0        11 Julia  pack~
# i 11,064 more rows
</pre></div>
</div>
</div>
</div>
<p>First, let’s examine how many times each person’s tweets were retweeted. We’ll calculate the total retweet count separately for David and Julia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">totals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">rts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">retweets</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">total_rts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">rts</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;person&#39;. You can override using the
`.groups` argument.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 2 x 2
  person total_rts
  &lt;chr&gt;      &lt;dbl&gt;
1 David      13012
2 Julia       1749
</pre></div>
</div>
</div>
</div>
<p>Next, let’s calculate the median number of retweets for each word and person. To avoid counting duplicate tweet/word pairs, we’ll use <a class="reference external" href="https://dplyr.tidyverse.org/reference/group_by.html"><code class="docutils literal notranslate"><span class="pre">group_by()</span></code></a> and <a class="reference external" href="https://dplyr.tidyverse.org/reference/summarise.html"><code class="docutils literal notranslate"><span class="pre">summarise()</span></code></a> twice in succession. The first <a class="reference external" href="https://dplyr.tidyverse.org/reference/summarise.html"><code class="docutils literal notranslate"><span class="pre">summarise()</span></code></a> calculates how many times each word was retweeted, grouped by tweet and person. In the second <a class="reference external" href="https://dplyr.tidyverse.org/reference/summarise.html"><code class="docutils literal notranslate"><span class="pre">summarise()</span></code></a>, we compute the median retweets for each word and person, while also counting how many times each word appeared overall for each person, saving that as <code class="docutils literal notranslate"><span class="pre">uses</span></code>. After that, we can join this to the data frame containing total retweet counts. Finally, we’ll use <a class="reference external" href="https://dplyr.tidyverse.org/reference/filter.html"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a> to keep only the words that were mentioned at least five times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_by_rts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">rts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">retweets</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">retweets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="n">rts</span><span class="p">),</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">left_join</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">retweets</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>

<span class="n">word_by_rts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">uses</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">retweets</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;id&#39;, &#39;word&#39;. You can override using the
`.groups` argument.
`summarise()` has grouped output by &#39;person&#39;. You can override using the
`.groups` argument.
Joining with `by = join_by(person)`
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 178 x 5
   person word          retweets  uses total_rts
   &lt;chr&gt;  &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt;
 1 David  animation         85       5     13012
 2 David  download          52       5     13012
 3 David  start             51       7     13012
 4 Julia  tidytext          50       7      1749
 5 David  gganimate         45       8     13012
 6 David  introducing       45       6     13012
 7 David  understanding     37       6     13012
 8 David  0                 35       7     13012
 9 David  error             34.5     8     13012
10 David  bayesian          34       7     13012
# i 168 more rows
</pre></div>
</div>
</div>
</div>
<p>At the top of this sorted data frame, the most retweeted words for both Julia and David relate to packages they contribute to, such as <a class="reference external" href="https://gganimate.com"><em>gganimate</em></a> and <a class="reference external" href="https://cran.r-project.org/web/packages/tidytext/index.html"><em>tidytext</em></a>. Next, we can create a plot showing the words with the highest median retweet counts for each account, highlighting which terms tend to garner more engagement on their tweets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_by_rts</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">uses</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="n">retweets</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="n">retweets</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">word</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">retweets</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Median # of retweets for tweets containing each word&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/670c83c6068bc08d0a0799951d2115924805710fdf6d67c9aa5376f3e9edb2bb.png"><img alt="../../../_images/670c83c6068bc08d0a0799951d2115924805710fdf6d67c9aa5376f3e9edb2bb.png" src="../../../_images/670c83c6068bc08d0a0799951d2115924805710fdf6d67c9aa5376f3e9edb2bb.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>We notice many words related to R packages, including <em>tidytext</em>—the very package this book focuses on! The “0” values for David come from tweets mentioning package version numbers, like <a class="reference external" href="https://x.com/drob/status/671430703234576384">“broom 0.4.0”</a> and similar.</p>
<p>Using a similar approach, we can analyze which words correspond to higher numbers of favorites. It will be interesting to see whether those words differ from the ones that lead to more retweets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">totals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">favs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">favorites</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">total_favs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">favs</span><span class="p">))</span>

<span class="n">word_by_favs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tidy_tweets</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">favs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">first</span><span class="p">(</span><span class="n">favorites</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">favorites</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="n">favs</span><span class="p">),</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">left_join</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">favorites</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;person&#39;. You can override using the
`.groups` argument.
`summarise()` has grouped output by &#39;id&#39;, &#39;word&#39;. You can override using the
`.groups` argument.
`summarise()` has grouped output by &#39;person&#39;. You can override using the
`.groups` argument.
Joining with `by = join_by(person)`
</pre></div>
</div>
</div>
</div>
<p>We have built the data frames we need. Now let’s make our visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">word_by_favs</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">uses</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="n">favorites</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="n">favorites</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">word</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">favorites</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">person</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Median # of favorites for tweets containing each word&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/a8bd03db4f4f02081495a4acf6963b592a687907dc591e1a591bb325d34eee46.png"><img alt="../../../_images/a8bd03db4f4f02081495a4acf6963b592a687907dc591e1a591bb325d34eee46.png" src="../../../_images/a8bd03db4f4f02081495a4acf6963b592a687907dc591e1a591bb325d34eee46.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>We notice some small differences between David and Julia, especially toward the lower end of the top 10 lists, but overall the words are mostly the same as those linked to retweets. Generally, the words that attract retweets also tend to attract favorites. A standout word for Julia in both charts is the hashtag for the NASA Datanauts program she’s been involved with.</p>
</section>
</section>
<section id="case-study-analyzing-usenet-text">
<h2>Case Study: Analyzing Usenet Text<a class="headerlink" href="#case-study-analyzing-usenet-text" title="Link to this heading">#</a></h2>
<p>In our final chapter, we’ll apply the techniques from this book to complete an end-to-end analysis of 20,000 messages posted to 20 Usenet bulletin boards in 1993. These bulletin boards cover a variety of topics such as politics, religion, cars, sports, and cryptography, providing a diverse collection of user-generated text. This dataset is publicly available at <a class="reference external" href="http://qwone.com/~jason/20Newsgroups/">http://qwone.com/~jason/20Newsgroups/</a> (specifically the <code class="docutils literal notranslate"><span class="pre">20news-bydate.tar.gz</span></code> file) and is widely used for text analysis and machine learning exercises.</p>
<section id="pre-processing">
<h3>Pre-processing<a class="headerlink" href="#pre-processing" title="Link to this heading">#</a></h3>
<p>We’ll begin by reading all the messages from the <code class="docutils literal notranslate"><span class="pre">20news-bydate</span></code> folder, where the files are organized into sub-folders, with one file per message. We can load these files using a combination of <a class="reference external" href="https://readr.tidyverse.org/reference/read_lines.html"><code class="docutils literal notranslate"><span class="pre">read_lines()</span></code></a>, <a class="reference external" href="https://purrr.tidyverse.org/reference/map.html"><code class="docutils literal notranslate"><span class="pre">map()</span></code></a>, and <a class="reference external" href="https://tidyr.tidyverse.org/reference/unnest.html"><code class="docutils literal notranslate"><span class="pre">unnest()</span></code></a>.</p>
<p>Keep in mind that this step may take several minutes to process all the documents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">training_folder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;data/20news-bydate/20news-bydate-train/&quot;</span>

<span class="c1"># Define a function to read all files from a folder into a data frame</span>
<span class="n">read_folder</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">infolder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">tibble</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dir</span><span class="p">(</span><span class="n">infolder</span><span class="p">,</span><span class="w"> </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">read_lines</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">transmute</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">basename</span><span class="p">(</span><span class="n">file</span><span class="p">),</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">unnest</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Use unnest() and map() to apply read_folder to each subfolder</span>
<span class="n">raw_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">tibble</span><span class="p">(</span><span class="n">folder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dir</span><span class="p">(</span><span class="n">training_folder</span><span class="p">,</span><span class="w"> </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">folder_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="w"> </span><span class="n">read_folder</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest</span><span class="p">(</span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">folder_out</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">transmute</span><span class="p">(</span><span class="n">newsgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">basename</span><span class="p">(</span><span class="n">folder</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">raw_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 511,617 x 3
   newsgroup   id    text                                                       
   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                                                      
 1 alt.atheism 49960 &quot;From: mathew &lt;mathew@mantis.co.uk&gt;&quot;                       
 2 alt.atheism 49960 &quot;Subject: Alt.Atheism FAQ: Atheist Resources&quot;              
 3 alt.atheism 49960 &quot;Summary: Books, addresses, music -- anything related to a~
 4 alt.atheism 49960 &quot;Keywords: FAQ, atheism, books, music, fiction, addresses,~
 5 alt.atheism 49960 &quot;Expires: Thu, 29 Apr 1993 11:57:19 GMT&quot;                   
 6 alt.atheism 49960 &quot;Distribution: world&quot;                                      
 7 alt.atheism 49960 &quot;Organization: Mantis Consultants, Cambridge. UK.&quot;         
 8 alt.atheism 49960 &quot;Supersedes: &lt;19930301143317@mantis.co.uk&gt;&quot;                
 9 alt.atheism 49960 &quot;Lines: 290&quot;                                               
10 alt.atheism 49960 &quot;&quot;                                                         
# i 511,607 more rows
</pre></div>
</div>
</div>
</div>
<p>Take note of the <code class="docutils literal notranslate"><span class="pre">newsgroup</span></code> column, which indicates the specific newsgroup each message belongs to, and the <code class="docutils literal notranslate"><span class="pre">id</span></code> column, which provides a unique identifier for each message within that group. Let’s explore which newsgroups are included and how many messages were posted in each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>

<span class="n">raw_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">messages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/f3b1e368268212bc699d8cafb5f8889c7ea87f6a5ea82629e0751e66ec432af9.png"><img alt="../../../_images/f3b1e368268212bc699d8cafb5f8889c7ea87f6a5ea82629e0751e66ec432af9.png" src="../../../_images/f3b1e368268212bc699d8cafb5f8889c7ea87f6a5ea82629e0751e66ec432af9.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>We can observe that Usenet newsgroup names follow a hierarchical structure, beginning with a broad category like “talk,” “sci,” or “rec,” and then narrowing down with more specific subtopics.</p>
<section id="pre-processing-text">
<h4>Pre-processing Text<a class="headerlink" href="#pre-processing-text" title="Link to this heading">#</a></h4>
<p>Most of the datasets we’ve worked with in this book were already pre-processed, so we didn’t have to remove things like copyright notices from the Jane Austen novels. In this case, though, each message includes additional structure and text that we’ll want to exclude from our analysis. For instance, every message contains a header with fields like “from:” or “in_reply_to:” that provide metadata about the message. Some messages also include automated email signatures, often starting after a line containing <code class="docutils literal notranslate"><span class="pre">--</span></code>.</p>
<p>We can handle this type of pre-processing using the <strong>dplyr</strong> package, combining functions like <a class="reference external" href="https://rdrr.io/r/base/cumsum.html"><code class="docutils literal notranslate"><span class="pre">cumsum()</span></code></a> (cumulative sum) with <a class="reference external" href="https://stringr.tidyverse.org/reference/str_detect.html"><code class="docutils literal notranslate"><span class="pre">str_detect()</span></code></a> from the <strong>stringr</strong> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span>

<span class="c1"># must occur after the first occurrence of an empty line,</span>
<span class="c1"># and before the first occurrence of a line starting with --</span>
<span class="n">cleaned_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raw_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">cumsum</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">         </span><span class="nf">cumsum</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^--&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Many lines also contain quoted text from other users, often introduced by a line such as “so-and-so writes…”. We can filter these out using a few regular expressions.</p>
<p>Additionally, we’ll manually remove two specific messages, <code class="docutils literal notranslate"><span class="pre">9704</span></code> and <code class="docutils literal notranslate"><span class="pre">9985</span></code>, as they contain a significant amount of non-text content.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cleaned_text</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cleaned_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^[^&gt;]+[A-Za-z\\d]&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writes(:|\\.\\.\\.)$&quot;</span><span class="p">),</span>
<span class="w">         </span><span class="o">!</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^In article &lt;&quot;</span><span class="p">),</span>
<span class="w">         </span><span class="o">!</span><span class="n">id</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9704</span><span class="p">,</span><span class="w"> </span><span class="m">9985</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>At this stage, we’re ready to apply <a class="reference external" href="https://juliasilge.github.io/tidytext/reference/unnest_tokens.html"><code class="docutils literal notranslate"><span class="pre">unnest_tokens()</span></code></a> to break the dataset into individual tokens, filtering out stop words in the process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">tidytext</span><span class="p">)</span>

<span class="n">usenet_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cleaned_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest_tokens</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[a-z&#39;]$&quot;</span><span class="p">),</span>
<span class="w">         </span><span class="o">!</span><span class="n">word</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">stop_words</span><span class="o">$</span><span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Each raw text dataset will need its own unique cleaning process, often involving some trial and error and investigation of atypical cases. It’s worth noting that this cleaning can be effectively done using tidy tools like <strong>dplyr</strong> and <strong>tidyr</strong>.</p>
</section>
</section>
<section id="words-in-newsgroups">
<h3>Words in Newsgroups<a class="headerlink" href="#words-in-newsgroups" title="Link to this heading">#</a></h3>
<p>With headers, signatures, and formatting removed, we can begin exploring frequently used words. For example, we might identify the most common words across the entire dataset or focus on specific newsgroups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">usenet_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 65,918 x 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 people       3656
 2 time         2709
 3 god          1627
 4 system       1610
 5 space        1135
 6 windows      1126
 7 program      1103
 8 bit          1101
 9 information  1094
10 government   1084
# i 65,908 more rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">words_by_newsgroup</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usenet_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="n">words_by_newsgroup</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 173,417 x 3
   newsgroup               word          n
   &lt;chr&gt;                   &lt;chr&gt;     &lt;int&gt;
 1 soc.religion.christian  god         917
 2 sci.space               space       902
 3 talk.politics.mideast   people      729
 4 sci.crypt               key         704
 5 comp.os.ms-windows.misc windows     638
 6 talk.politics.mideast   armenian    583
 7 sci.crypt               db          549
 8 talk.politics.mideast   turkish     515
 9 rec.autos               car         512
10 talk.politics.mideast   armenians   509
# i 173,407 more rows
</pre></div>
</div>
</div>
</div>
<section id="finding-tf-idf-within-newsgroups">
<h4>Finding tf-idf Within Newsgroups<a class="headerlink" href="#finding-tf-idf-within-newsgroups" title="Link to this heading">#</a></h4>
<p>Since newsgroups vary by topic and content, we’d expect word frequencies to differ across them. Let’s quantify this difference using the tf-idf metric.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tf_idf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">words_by_newsgroup</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">bind_tf_idf</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 173,417 x 6
   newsgroup                word               n      tf   idf tf_idf
   &lt;chr&gt;                    &lt;chr&gt;          &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 comp.sys.ibm.pc.hardware scsi             485 0.0173   1.20 0.0209
 2 talk.politics.mideast    armenian         583 0.00805  2.30 0.0185
 3 rec.motorcycles          bike             324 0.0137   1.20 0.0165
 4 talk.politics.mideast    armenians        509 0.00703  2.30 0.0162
 5 sci.crypt                encryption       410 0.00802  1.90 0.0152
 6 rec.sport.hockey         hockey           293 0.00815  1.61 0.0131
 7 rec.sport.hockey         nhl              157 0.00437  3.00 0.0131
 8 talk.politics.misc       stephanopoulos   158 0.00417  3.00 0.0125
 9 rec.motorcycles          bikes             97 0.00410  3.00 0.0123
10 comp.windows.x           oname            136 0.00347  3.00 0.0104
# i 173,407 more rows
</pre></div>
</div>
</div>
</div>
<p>We can explore the highest tf-idf values for selected groups to identify words unique to those topics. For instance, we might focus on all the <code class="docutils literal notranslate"><span class="pre">sci.</span></code> boards.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tf_idf</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^sci\\.&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">tf_idf</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">tf_idf</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tf-idf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/1773955349ef648ef21111e055cb1c299d9899171c1f5d09fc9624540f1b44de.png"><img alt="../../../_images/1773955349ef648ef21111e055cb1c299d9899171c1f5d09fc9624540f1b44de.png" src="../../../_images/1773955349ef648ef21111e055cb1c299d9899171c1f5d09fc9624540f1b44de.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>We observe many distinctive words tied to specific newsgroups, like “wiring” and “circuit” in <em>sci.electronics</em> and “orbit” and “lunar” in the space newsgroup. You can use this same approach to explore other newsgroups on your own.</p>
<p>Which newsgroups show similar text content? We can investigate this by calculating the pairwise correlation of word frequencies between newsgroups using the <a class="reference external" href="https://juliasilge.github.io/widyr/reference/pairwise_cor.html"><code class="docutils literal notranslate"><span class="pre">pairwise_cor()</span></code></a> function from the <strong>widyr</strong> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">widyr</span><span class="p">)</span>

<span class="n">newsgroup_cors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">words_by_newsgroup</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">pairwise_cor</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">newsgroup_cors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 380 x 3
   item1                    item2                    correlation
   &lt;chr&gt;                    &lt;chr&gt;                          &lt;dbl&gt;
 1 talk.religion.misc       soc.religion.christian         0.835
 2 soc.religion.christian   talk.religion.misc             0.835
 3 alt.atheism              talk.religion.misc             0.773
 4 talk.religion.misc       alt.atheism                    0.773
 5 alt.atheism              soc.religion.christian         0.744
 6 soc.religion.christian   alt.atheism                    0.744
 7 comp.sys.mac.hardware    comp.sys.ibm.pc.hardware       0.675
 8 comp.sys.ibm.pc.hardware comp.sys.mac.hardware          0.675
 9 rec.sport.baseball       rec.sport.hockey               0.574
10 rec.sport.hockey         rec.sport.baseball             0.574
# i 370 more rows
</pre></div>
</div>
</div>
</div>
<p>Next, we can filter for stronger correlations between newsgroups and visualize these relationships as a network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ggraph</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">igraph</span><span class="p">)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">2017</span><span class="p">)</span>

<span class="n">newsgroup_cors</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">correlation</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">.</span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">graph_from_data_frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggraph</span><span class="p">(</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;fr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_edge_link</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlation</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correlation</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_node_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lightblue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_node_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">repel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_void</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/daf68a6552b74342509cb3fd8a6bfaf44914bef4e07ffeaa470f7d8d24a0ddab.png"><img alt="../../../_images/daf68a6552b74342509cb3fd8a6bfaf44914bef4e07ffeaa470f7d8d24a0ddab.png" src="../../../_images/daf68a6552b74342509cb3fd8a6bfaf44914bef4e07ffeaa470f7d8d24a0ddab.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>It appears there are four main clusters of newsgroups: computers and electronics, politics and religion, motor vehicles, and sports. This grouping aligns well with the words and topics we would expect these newsgroups to share.</p>
</section>
<section id="topic-modeling">
<h4>Topic Modeling<a class="headerlink" href="#topic-modeling" title="Link to this heading">#</a></h4>
<p>Previously, we used Latent Dirichlet Allocation (LDA) to separate chapters back into their original books. Could LDA also classify Usenet messages by their respective newsgroups?</p>
<p>Let’s test this by dividing messages from four science-related newsgroups. First, we convert the data into a document-term matrix using <a class="reference external" href="https://juliasilge.github.io/tidytext/reference/document_term_casters.html"><code class="docutils literal notranslate"><span class="pre">cast_dtm()</span></code></a>, then fit the model with the <a class="reference external" href="https://rdrr.io/cran/topicmodels/man/lda.html"><code class="docutils literal notranslate"><span class="pre">LDA()</span></code></a> function from the <strong>topicmodels</strong> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># include only words that occur at least 50 times</span>
<span class="n">word_sci_newsgroups</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usenet_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^sci&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">word_total</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">50</span><span class="p">)</span>

<span class="c1"># convert into a document-term matrix</span>
<span class="c1"># with document names such as sci.crypt_14147</span>
<span class="n">sci_dtm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">word_sci_newsgroups</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unite</span><span class="p">(</span><span class="n">document</span><span class="p">,</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">document</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">cast_dtm</span><span class="p">(</span><span class="n">document</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">topicmodels</span><span class="p">)</span>
<span class="n">sci_lda</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">LDA</span><span class="p">(</span><span class="n">sci_dtm</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2016</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>What four topics did this model identify, and how well did they correspond to the original newsgroups? This method should be familiar we will visualize each topic by highlighting its most frequent terms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sci_lda</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">tidy</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder_within</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">topic</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">topic</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_reordered</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/b3c8bf0cc509c9d68c7c64c0d03a092e261d178a6fb2ac9008d8315ef7a0bd98.png"><img alt="../../../_images/b3c8bf0cc509c9d68c7c64c0d03a092e261d178a6fb2ac9008d8315ef7a0bd98.png" src="../../../_images/b3c8bf0cc509c9d68c7c64c0d03a092e261d178a6fb2ac9008d8315ef7a0bd98.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>Based on the top words, we can begin to infer which topics correspond to which newsgroups. Topic 1 clearly represents <em>sci.space</em>, as indicated by “space” being the most frequent word, while topic 2 likely relates to cryptography, featuring terms like “key” and “encryption.” We can validate this by examining how documents from each newsgroup have higher gamma, <span class="math notranslate nohighlight">\(\gamma\)</span>, values for their respective topics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sci_lda</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">tidy</span><span class="p">(</span><span class="n">matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;gamma&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">separate</span><span class="p">(</span><span class="n">document</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;newsgroup&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">newsgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">gamma</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">topic</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">topic</span><span class="p">),</span><span class="w"> </span><span class="n">gamma</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Topic&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;# of messages where this was the highest % topic&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/ea87aaf2c1c0a489c0bc261c6d0bf2d1b6d57bfe66858a24307d71947c845fe0.png"><img alt="../../../_images/ea87aaf2c1c0a489c0bc261c6d0bf2d1b6d57bfe66858a24307d71947c845fe0.png" src="../../../_images/ea87aaf2c1c0a489c0bc261c6d0bf2d1b6d57bfe66858a24307d71947c845fe0.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>As we saw in the literature example, topic modeling successfully identified distinct topics in the text without using the original labels.</p>
<p>However, the separation of Usenet messages was less clear-cut than the division of book chapters. Many messages from each newsgroup showed high gamma, <span class="math notranslate nohighlight">\(\gamma\)</span>, values for multiple topics. This is expected since many messages are brief and may share vocabulary—for instance, conversations about space travel might overlap with terms used in electronics discussions. This example realistically illustrates how LDA assigns documents to broad topics while permitting some overlap.</p>
</section>
</section>
<section id="sentiment-analysis">
<h3>Sentiment Analysis<a class="headerlink" href="#sentiment-analysis" title="Link to this heading">#</a></h3>
<p>We can apply the sentiment analysis methods from before to assess the frequency of positive and negative words in these Usenet posts. Which newsgroups tend to be the most positive or negative overall?</p>
<p>For this example, we’ll use the AFINN sentiment lexicon, which assigns numeric sentiment scores to words, and display the results using a bar plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">newsgroup_sentiments</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">words_by_newsgroup</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="nf">get_sentiments</span><span class="p">(</span><span class="s">&quot;afinn&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="n">newsgroup_sentiments</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">newsgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Average sentiment value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/b6a327cc0ea24fc3e9685dd8f4de51598b683d274c763ad4907340f32dc3bfac.png"><img alt="../../../_images/b6a327cc0ea24fc3e9685dd8f4de51598b683d274c763ad4907340f32dc3bfac.png" src="../../../_images/b6a327cc0ea24fc3e9685dd8f4de51598b683d274c763ad4907340f32dc3bfac.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>This analysis shows that the “misc.forsale” newsgroup was the most positive overall. This is understandable, as users probably used many positive adjectives when describing items they wanted to sell!</p>
<section id="sentiment-analysis-by-word">
<h4>Sentiment Analysis by Word<a class="headerlink" href="#sentiment-analysis-by-word" title="Link to this heading">#</a></h4>
<p>It’s helpful to explore further to see <em>why</em> certain newsgroups scored as more positive or negative. To do this, we can analyze the overall positive and negative contributions of individual words.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">contributions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usenet_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="nf">get_sentiments</span><span class="p">(</span><span class="s">&quot;afinn&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">occurences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">(),</span>
<span class="w">            </span><span class="n">contribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="n">contributions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 1,909 x 3
   word      occurences contribution
   &lt;chr&gt;          &lt;int&gt;        &lt;dbl&gt;
 1 abandon           13          -<span class=" -Color -Color-Red">26</span>
 2 abandoned         19          -<span class=" -Color -Color-Red">38</span>
 3 abandons           3           -<span class=" -Color -Color-Red">6</span>
 4 abduction          2           -<span class=" -Color -Color-Red">4</span>
 5 abhor              4          -<span class=" -Color -Color-Red">12</span>
 6 abhorred           1           -<span class=" -Color -Color-Red">3</span>
 7 abhorrent          2           -<span class=" -Color -Color-Red">6</span>
 8 abilities         16           32
 9 ability          177          354
10 aboard             8            8
# i 1,899 more rows
</pre></div>
</div>
</div>
</div>
<p>Which words had the most effect on sentiment values overall?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">contributions</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">contribution</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">contribution</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contribution</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/e5306702d957cc718d9648fae1e4fc44e0cc740f974eb24a448200f47e40ec0e.png"><img alt="../../../_images/e5306702d957cc718d9648fae1e4fc44e0cc740f974eb24a448200f47e40ec0e.png" src="../../../_images/e5306702d957cc718d9648fae1e4fc44e0cc740f974eb24a448200f47e40ec0e.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>These words generally seem like reasonable indicators of sentiment, but some issues are apparent. For example, “true” might appear in negative phrases like “not true,” and words like “God” and “Jesus” are frequent on Usenet but could be used in both positive and negative contexts.</p>
<p>We may also want to examine which words contribute most to sentiment <em>within each newsgroup</em>, helping identify any newsgroups where the sentiment estimates might be misleading.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">top_sentiment_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">words_by_newsgroup</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="nf">get_sentiments</span><span class="p">(</span><span class="s">&quot;afinn&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">contribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can compute how much each word contributes to the sentiment score of each newsgroup and then visualize the most influential words from a selection of groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">top_sentiment_words</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 13,078 x 5
   newsgroup              word       n value contribution
   &lt;chr&gt;                  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;
 1 soc.religion.christian god      917     1      0.0144 
 2 soc.religion.christian jesus    440     1      0.00690
 3 talk.politics.guns     gun      425    -<span class=" -Color -Color-Red">1</span>     -<span class=" -Color -Color-Red">0.00667</span>
 4 talk.religion.misc     god      296     1      0.00464
 5 alt.atheism            god      268     1      0.00421
 6 soc.religion.christian faith    257     1      0.00403
 7 talk.religion.misc     jesus    256     1      0.00402
 8 talk.politics.mideast  killed   202    -<span class=" -Color -Color-Red">3</span>     -<span class=" -Color -Color-Red">0.00951</span>
 9 talk.politics.mideast  war      187    -<span class=" -Color -Color-Red">2</span>     -<span class=" -Color -Color-Red">0.00587</span>
10 soc.religion.christian true     179     2      0.00562
# i 13,068 more rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">top_sentiment_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="nf">str_detect</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^(talk|alt|misc)&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">contribution</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">newsgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">contribution</span><span class="p">),</span>
<span class="w">         </span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder_within</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">contribution</span><span class="p">,</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contribution</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_reordered</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sentiment value * # of occurrences&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/e91e65b8d878f745c46f954a49acf9fe7bbf3b6b2bb558ae4d838b2e63b49b95.png"><img alt="../../../_images/e91e65b8d878f745c46f954a49acf9fe7bbf3b6b2bb558ae4d838b2e63b49b95.png" src="../../../_images/e91e65b8d878f745c46f954a49acf9fe7bbf3b6b2bb558ae4d838b2e63b49b95.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>This supports our earlier guess about the “misc.forsale” newsgroup: most of its positive sentiment comes from adjectives like “excellent” and “perfect.” It also highlights how sentiment can be intertwined with topic. For example, an atheism newsgroup might frequently mention “god” in a negative way, yet this causes the group to appear more positive overall. Likewise, the word “gun” may contribute negatively to the “talk.politics.guns” group even when discussed positively.</p>
<p>This serves as a reminder that sentiment analysis can be influenced by topic, so it’s important to review the key contributing words before drawing strong conclusions.</p>
</section>
<section id="sentiment-analysis-by-message">
<h4>Sentiment Analysis by Message<a class="headerlink" href="#sentiment-analysis-by-message" title="Link to this heading">#</a></h4>
<p>We can also identify the most positive and negative individual messages by grouping and summarizing the data by <code class="docutils literal notranslate"><span class="pre">id</span></code> instead of by <code class="docutils literal notranslate"><span class="pre">newsgroup</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sentiment_messages</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usenet_words</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="nf">get_sentiments</span><span class="p">(</span><span class="s">&quot;afinn&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">sentiment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
<span class="w">            </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">words</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;newsgroup&#39;. You can override using the
`.groups` argument.
</pre></div>
</div>
</div>
</div>
<p>As a simple measure to reduce the role of randomness, we filtered out messages that had fewer than five words that contributed to sentiment.</p>
<p>What were the most positive messages?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sentiment_messages</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">sentiment</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 3,565 x 4
   newsgroup               id     sentiment words
   &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
 1 rec.sport.hockey        53560       3.89    18
 2 rec.sport.hockey        53602       3.83    30
 3 rec.sport.hockey        53822       3.83     6
 4 comp.windows.x          66905       3.32    19
 5 comp.windows.x          66906       3.32    19
 6 comp.os.ms-windows.misc 9904        3.29     7
 7 rec.sport.hockey        53645       3.23    13
 8 rec.autos               102768      3.2      5
 9 misc.forsale            75965       3        5
10 misc.forsale            76037       3        5
# i 3,555 more rows
</pre></div>
</div>
</div>
</div>
<p>To verify this, let’s examine the most positive message in the entire dataset. To help with this, we can create a simple function that prints a specified message.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">print_message</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">message_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cleaned_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">    </span><span class="nf">filter</span><span class="p">(</span><span class="n">newsgroup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">message_id</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">  </span>
<span class="w">  </span><span class="nf">cat</span><span class="p">(</span><span class="n">result</span><span class="o">$</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">print_message</span><span class="p">(</span><span class="s">&quot;rec.sport.hockey&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">53560</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Everybody.  Please send me your predictions for the Stanley Cup Playoffs!
I want to see who people think will win.!!!!!!!
Please Send them in this format, or something comparable:
1. Winner of Buffalo-Boston
2. Winner of Montreal-Quebec
3. Winner of Pittsburgh-New York
4. Winner of New Jersey-Washington
5. Winner of Chicago-(Minnesota/St.Louis)
6. Winner of Toronto-Detroit
7. Winner of Vancouver-Winnipeg
8. Winner of Calgary-Los Angeles
9. Winner of Adams Division (1-2 above)
10. Winner of Patrick Division (3-4 above)
11. Winner of Norris Division (5-6 above)
12. Winner of Smythe Division (7-8 above)
13. Winner of Wales Conference (9-10 above)
14. Winner of Campbell Conference (11-12 above)
15. Winner of Stanley Cup (13-14 above)
I will summarize the predictions, and see who is the biggest
INTERNET GURU PREDICTING GUY/GAL.
Send entries to Richard Madison
rrmadiso@napier.uwaterloo.ca
PS:  I will send my entries to one of you folks so you know when I say
I won, that I won!!!!!
NULL
</pre></div>
</div>
</div>
</div>
<p>It appears this message was flagged as most positive due to frequent use of the word “winner.” What about the most negative message? Interestingly, it’s also from the hockey site but expresses a very different sentiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">sentiment_messages</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="n">sentiment</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">print</span><span class="p">()</span>

<span class="nf">print_message</span><span class="p">(</span><span class="s">&quot;rec.sport.hockey&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">53907</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># A tibble: 3,565 x 4
   newsgroup             id     sentiment words
   &lt;chr&gt;                 &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;
 1 rec.sport.hockey      53907      -<span class=" -Color -Color-Red">3</span>        6
 2 sci.electronics       53899      -<span class=" -Color -Color-Red">3</span>        5
 3 talk.politics.mideast 75918      -<span class=" -Color -Color-Red">3</span>        7
 4 rec.autos             101627     -<span class=" -Color -Color-Red">2.83</span>     6
 5 comp.graphics         37948      -<span class=" -Color -Color-Red">2.8</span>      5
 6 comp.windows.x        67204      -<span class=" -Color -Color-Red">2.7</span>     10
 7 talk.politics.guns    53362      -<span class=" -Color -Color-Red">2.67</span>     6
 8 alt.atheism           51309      -<span class=" -Color -Color-Red">2.6</span>      5
 9 comp.sys.mac.hardware 51513      -<span class=" -Color -Color-Red">2.6</span>      5
10 rec.autos             102883     -<span class=" -Color -Color-Red">2.6</span>      5
# i 3,555 more rows
Losers like us? You are the fucking moron who has never heard of the Western
Business School, or the University of Western Ontario for that matter. Why 
don&#39;t you pull your head out of your asshole and smell something other than
shit for once so you can look on a map to see where UWO is! Back to hockey,
the North Stars should be moved because for the past few years they have
just been SHIT. A real team like Toronto would never be moved!!!
Andrew--
</pre></div>
</div>
</div>
</div>
</section>
<section id="n-gram-analysis">
<h4>N-gram Analysis<a class="headerlink" href="#n-gram-analysis" title="Link to this heading">#</a></h4>
<p>Earlier, we examined how words like “not” and “no” affect sentiment analysis of Jane Austen’s novels—such as whether phrases like “don’t like” cause passages to be misclassified as positive. Since the Usenet dataset is a much larger and more contemporary corpus, we might want to explore how sentiment reversal occurs in this text.</p>
<p>To begin, we’ll identify and count all the bigrams in the Usenet posts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">usenet_bigrams</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cleaned_text</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">unnest_tokens</span><span class="p">(</span><span class="n">bigram</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ngrams&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">usenet_bigram_counts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">usenet_bigrams</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">newsgroup</span><span class="p">,</span><span class="w"> </span><span class="n">bigram</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">separate</span><span class="p">(</span><span class="n">bigram</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;word1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;word2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we can define a list of six words likely to indicate negation—such as “no,” “not,” and “without”—and visualize the sentiment-related words that most frequently follow them. This highlights words that often contributed to sentiment in the “wrong” direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">negate_words</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;not&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;without&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;can&#39;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;don&#39;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;won&#39;t&quot;</span><span class="p">)</span>

<span class="n">usenet_bigram_counts</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">word1</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">negate_words</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">count</span><span class="p">(</span><span class="n">word1</span><span class="p">,</span><span class="w"> </span><span class="n">word2</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">inner_join</span><span class="p">(</span><span class="nf">get_sentiments</span><span class="p">(</span><span class="s">&quot;afinn&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">word2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;word&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">contribution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">word1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">slice_max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">contribution</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">word2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">reorder_within</span><span class="p">(</span><span class="n">word2</span><span class="p">,</span><span class="w"> </span><span class="n">contribution</span><span class="p">,</span><span class="w"> </span><span class="n">word1</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">contribution</span><span class="p">,</span><span class="w"> </span><span class="n">word2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contribution</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">word1</span><span class="p">,</span><span class="w"> </span><span class="n">scales</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;free&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_reordered</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sentiment value * # of occurrences&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Words preceded by a negation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/37ffcd67513d4b0010cc4316dcd810926dbef939f38685b6f63cb457a45a7f95.png"><img alt="../../../_images/37ffcd67513d4b0010cc4316dcd810926dbef939f38685b6f63cb457a45a7f95.png" src="../../../_images/37ffcd67513d4b0010cc4316dcd810926dbef939f38685b6f63cb457a45a7f95.png" style="width: 420px; height: 420px;" />
</a>
</div>
</div>
<p>It appears that the biggest causes of misclassifying words as positive stem from phrases like “don’t want/like/care,” while the most common source of incorrectly labeled negative sentiment is the phrase “no problem.”</p>
</section>
</section>
</section>
<section id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">#</a></h2>
<p>We would like to acknowledge the work of Julia Silge and David Robinson, whose materials were used under the terms of the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 United States License. Their contributions to open data science education, particularly the <a class="reference external" href="https://www.tidytextmining.com">Text Mining with R</a>, provided valuable resources for this project.</p>
<p>This notebook was created by Meara Cox using their code and examples as a foundation, with additional explanations and adaptations to support the goals of this project.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./src/RForTextAnalysis/GettingStarted"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-packages">Install Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-comparing-twitter-archives">Case study: Comparing Twitter Archives</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-data-and-distribution">Getting the Data and Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#word-frequencies">Word Frequencies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-word-usage">Comparing Word Usage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#changes-in-word-use">Changes in Word Use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#favorites-and-retweets">Favorites and Retweets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-analyzing-usenet-text">Case Study: Analyzing Usenet Text</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing">Pre-processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing-text">Pre-processing Text</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#words-in-newsgroups">Words in Newsgroups</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-tf-idf-within-newsgroups">Finding tf-idf Within Newsgroups</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#topic-modeling">Topic Modeling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis">Sentiment Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis-by-word">Sentiment Analysis by Word</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sentiment-analysis-by-message">Sentiment Analysis by Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#n-gram-analysis">N-gram Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acknowledgements">Acknowledgements</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By University of South Carolina Libraries
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>